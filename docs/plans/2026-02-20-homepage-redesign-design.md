# 赞美在线平台重构设计文档

**日期**: 2026-02-20
**作者**: Claude Code
**状态**: 待实现

---

## 一、项目概述

将现有的"赞美诗播放器"重构为一个多模块的信仰生活平台，包含赞美、话语、圣经、资料四个核心模块。

---

## 二、整体架构

### 2.1 技术架构

- **单页 SPA**：单个 `index.html` 文件，通过 JavaScript 控制模块显示/隐藏
- **无构建步骤**：保持 vanilla JS，无需打包工具
- **部署平台**：Cloudflare Pages + Worker + R2

### 2.2 导航结构

```
首页（模块选择）
├── 赞美 → 播放器界面
├── 话语 → 话语列表 → 话语详情
├── 圣经 → 书卷选择 → 章节选择 → 经文显示
└── 资料 → 资料列表 → 资料详情
```

### 2.3 路由设计（Hash）

| 路由 | 页面 |
|------|------|
| `#home` | 首页（模块卡片） |
| `#praise` | 赞美模块 |
| `#words` | 话语列表 |
| `#words/:id` | 话语详情 |
| `#bible` | 书卷选择 |
| `#bible/:book` | 章节选择 |
| `#bible/:book/:ch` | 经文显示 |
| `#resources` | 资料列表 |

---

## 三、各模块设计

### 3.1 首页

**布局**：2x2 网格（桌面）+ 2 列（移动端）

**卡片内容**：
- 图标
- 模块名称
- 副标题（可选）

**模块卡片**：
| 模块 | 图标 | 描述 |
|------|------|------|
| 赞美 | 🎵 | 赞美诗播放 |
| 话语 | 📜 | 每日话语分享 |
| 圣经 | ✝️ | 圣经阅读器 |
| 资料 | 📁 | 学习资料 |

### 3.2 赞美模块（现有）

保持现有功能：
- 5 个分类（附录、大本、新编、少儿、集中）
- 搜索、过滤、排序
- 播放器、定时、最近播放
- **新增**：返回首页按钮

### 3.3 话语模块

**页面结构**：
- 标题栏：标题 + 返回首页按钮
- 列表区：按时间倒序显示

**条目格式**：`2025-01-15 主题标题`

**数据存储**（R2）：
```
jiamingzh/worship/
├── 2025-01-15-主题A.mp3
├── 2025-01-08-主题B.mp3
└── ...
```

**交互**：点击播放音频（复用底部播放器）

### 3.4 圣经模块

**页面层级**：
1. 书卷选择（旧约/新约分组）
2. 章节选择
3. 经文显示

**导航**：顶部显示路径 `创世记 > 第1章`，支持返回上一级

**数据存储**（R2）：
```
bible/
├── 01-创世记.txt
├── 02-出埃及记.txt
└── ...
```

**文件格式**：每章用分隔符（如 `===第N章===`）或 JSON 结构

### 3.5 资料模块

**页面结构**：
- 标题栏：标题 + 返回首页按钮 + 类型筛选
- 列表区：文件名 + 类型图标

**支持类型**：PDF、音频、视频、文档

**数据存储**（R2）：
```
resources/
├── pdf/
├── audio/
├── video/
└── docs/
```

**交互行为**：
- PDF/文档：新标签页打开
- 音频：调用底部播放器
- 视频：页面内播放

---

## 四、Worker API 扩展

### 4.1 现有接口

```javascript
GET /api/list?dir=<path>  // 列出文件
GET /api/file/<encoded-key>  // 获取文件
```

### 4.2 新增接口

```javascript
// 话语列表
GET /api/list?dir=jiamingzh/worship/

// 圣经书卷列表
GET /api/bible/books

// 圣经章节内容
GET /api/bible/file/<encoded-book>

// 资料列表
GET /api/list?dir=resources/
```

---

## 五、UI/UX 设计

### 5.1 设计风格

- 保持现有玻璃态（glassmorphism）风格
- 移动端优先响应式设计

### 5.2 返回首页按钮

- **位置**：Header 左侧，主题切换按钮旁边
- **状态**：首页隐藏，子模块显示
- **样式**：与主题切换按钮一致

### 5.3 状态持久化

- URL hash 支持浏览器前进/后退
- 刷新页面保持当前状态
- 各模块独立 localStorage 命名空间

---

## 六、代码组织

```
pages/
├── index.html     (主入口)
├── style.css      (通用样式)
├── theme.css      (主题样式)
├── app.js         (主逻辑)
│   ├── 路由模块
│   ├── 首页模块
│   ├── 赞美模块（现有）
│   ├── 话语模块
│   ├── 圣经模块
│   └── 资料模块
└── theme.js       (主题切换)
```

### 6.1 app.js 模块划分

```javascript
// 路由模块
const Router = { ... };

// 首页模块
const HomePage = { ... };

// 赞美模块（现有代码重构）
const PraiseModule = { ... };

// 话语模块
const WordsModule = { ... };

// 圣经模块
const BibleModule = { ... };

// 资料模块
const ResourcesModule = { ... };
```

---

## 七、实施计划

1. **Phase 1**: 重构 app.js，提取模块结构
2. **Phase 2**: 实现路由系统和首页
3. **Phase 3**: 实现话语模块
4. **Phase 4**: 实现圣经模块
5. **Phase 5**: 实现资料模块
6. **Phase 6**: 扩展 Worker API
7. **Phase 7**: 测试和优化

---

## 八、待确认事项

- [ ] 圣经文件的具体格式（JSON vs 分隔符）
- [ ] 资料模块是否需要预览功能
- [ ] 是否需要搜索功能（圣经/话语/资料）
